<data-definition>
    <enum-type type-name='abstract_building_type'> bay12: AbstractBuilding
        <enum-item name='STORE'/>
        <enum-item name='MEAD_HALL'/>
        <enum-item name='KEEP'/>
        <enum-item name='HOME_SINGLE'/>
        <enum-item name='HOME_APARTMENT'/>
        <enum-item name='HOME_APARTMENT_ROOM'/>
        <enum-item name='TEMPLE'/>
        <enum-item name='DARK_TOWER'/>
        <enum-item name='MARKET'/>
    </enum-type>

    <enum-type type-name='abstract_building_flags'> bay12: AbstractBuildingFlag
        <enum-item name='WG_RUINED'/>
        <enum-item name='DOES_NOT_EXIST'/>
        <enum-item name='DISCOVERED' comment="gets toggled when an adventurer has visited it."/>
    </enum-type>

    <class-type type-name='abstract_building' original-name='abstract_buildingst' key-field='id'>
        <int32_t name='id'/>

        <code-helper name='find-instance'>
            (find-by-id $(find-instance $world_site $$).buildings $id $)
        </code-helper>

        <stl-vector name='inhabitants'>
            <pointer> bay12: abstract_building_hf_linkst
                <enum name='type' type-name='histfig_hf_link_type' base-type='int16_t'/>
                <int32_t name='histfig_id' ref-target='historical_figure'/>
            </pointer>
        </stl-vector>
        <df-flagarray name='flags' index-enum='abstract_building_flags'/>
        <pointer name='archinfo' comment='in temples; hfig is the god'> bay12: architectural_infost
            <stl-vector name='hfig' ref-target='historical_figure' type-name='int32_t'/>
            <int32_t name='architect_hf' ref-target='historical_figure'/>
            <stl-vector name='architectural_elements'><enum type-name='architectural_element' base-type='int16_t'/></stl-vector>
            <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index' comment='just a guess'/>
            <int32_t name='mat_index'/>
        </pointer>
        <stl-vector type-name='int32_t'/>
        <int32_t/>

        <virtual-methods>
            <vmethod ret-type='abstract_building_type' name='getType'/>
            <vmethod ret-type='int16_t' name='getSubtype' comment='for stores'/>
            <vmethod name='getDisplayTile' comment='on navigation minimap'>
                <pointer type-name='uint8_t' name='tile'/>
                <pointer type-name='int16_t' name='fg'/>
                <pointer type-name='int16_t' name='bg'/>
                <pointer type-name='int16_t' name='bright'/>
            </vmethod>
            <vmethod name='getName'><ret-type><pointer type-name='language_name'/></ret-type></vmethod>
            <vmethod name='write_file'> <pointer name='file' type-name='file_compressorst'/> </vmethod>

            <vmethod name='read_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <int32_t name='loadversion'/>
            </vmethod>
            <vmethod is-destructor='true'/>
            <vmethod ret-type='int32_t' name='getReligionID'/>
            <vmethod ret-type='bool' name='razeable'/>
            <vmethod ret-type='bool' name='canDisplayBody'/>

            <vmethod ret-type='int32_t' name='getDefensePerc'/>
        </virtual-methods>
    </class-type>

    <enum-type type-name='abstract_building_store_subtype' base-type='int16_t'>
        <enum-item name='Craft'/>
        <enum-item name='Weapon'/>
        <enum-item name='Armor'/>
        <enum-item name='Clothing'/>
        <enum-item name='Food'/>
    </enum-type>

    <class-type type-name='abstract_building_storest' inherits-from='abstract_building'>
        <enum type-name='abstract_building_store_subtype' name='subtype'/>
        <compound name='name' type-name='language_name'/>
    </class-type>

    <class-type type-name='abstract_building_mead_hallst' inherits-from='abstract_building'>
        <compound name='name' type-name='language_name'/>
    </class-type>

    <class-type type-name='abstract_building_keepst' inherits-from='abstract_building'>
        <compound name='name' type-name='language_name'/>
    </class-type>

    <class-type type-name='abstract_building_home_singlest' inherits-from='abstract_building'/>

    <class-type type-name='abstract_building_home_apartmentst' inherits-from='abstract_building'/>

    <class-type type-name='abstract_building_home_apartment_roomst' inherits-from='abstract_building'/>


    <enum-type type-name='religious_practice_type' base-type='int32_t'> bay12: ReligiousPracticeType
        <enum-item name='NONE' value='-1'/>
        <enum-item name='WORSHIP_HFID'/>
        <enum-item name='RELIGION_ENID'/>
    </enum-type>

    <class-type type-name='abstract_building_templest' inherits-from='abstract_building'>
        <enum name='deity_type' type-name='religious_practice_type'/>
        <compound name='deity_data' is-union='true'>
            <int32_t name='practice_id'/>
            <int32_t name='Deity' ref-target='historical_figure'/>
            <int32_t name='Religion' ref-target='historical_entity'/>
        </compound>
        <compound name='name' type-name='language_name'/>
    </class-type>

    <class-type type-name='abstract_building_dark_towerst' inherits-from='abstract_building'>
        <compound name='name' type-name='language_name'/>
    </class-type>

    <class-type type-name='abstract_building_marketst' inherits-from='abstract_building'>
        <compound name='name' type-name='language_name'/>
    </class-type>

    <enum-type type-name='world_site_type'> bay12: SiteType
        <enum-item name='PlayerFortress'/>
        <enum-item name='DarkFortress'/>
        <enum-item name='Cave'/>
        <enum-item name='MountainHalls'/>
        <enum-item name='ForestRetreat'/>
        <enum-item name='Town'/>
        <enum-item name='ImportantLocation'/>
        <enum-item name='LairShrine'/>
        <enum-item name='Fortress'/>
        <enum-item name='Camp'/>
    </enum-type>

    <enum-type type-name='lair_type' base-type='int16_t'> bay12: LairType
        <enum-item name='NONE' value='-1'/>
        <enum-item name='SIMPLE_MOUND' comment='Night creatures'/>
        <enum-item name='SIMPLE_BURROW' comment='animal, (semi)megabeast, night creature(!)'/>
        <enum-item name='LABYRINTH'/>
        <enum-item name='SHRINE'/>
        <enum-item name='WILDERNESS_LOCATION' comment='In mountains, hosting Rocs in vanilla'/>
    </enum-type>

    <struct-type type-name='populacest'>
        <stl-vector name="nemesis" type-name='int32_t' ref-target='nemesis_record'/>

        <stl-vector name="items" type-name='int32_t' ref-target='item'/>

        <stl-vector name="animals" pointer-type='world_population'/>

        <stl-vector name="inhabitants" pointer-type='world_site_inhabitant'/>

        <stl-vector name='hist_fig_id' type-name='int32_t' comment='worldgen only'/>
        <stl-vector name='hist_fig' pointer-type='historical_figure' comment='worldgen only'/>
    </struct-type>

    <struct-type type-name='site_cropst'>
        <int32_t name='production_zone_index'/>
        <int32_t name='allotment_index'/>
        <int32_t name='count'/>
        <int32_t name='planting_week'/>
    </struct-type>

    <enum-type type-name='site_flag_type'> SiteFlagType
        <enum-item name='HIDDEN'/>
        <enum-item name='RUINED'/>
        <enum-item name='IGNORED_BY_LEGENDS'/>
        <enum-item name='HAS_MARKET'/>
        <enum-item name='VISITED'/>
        <enum-item name='ACTIVE'/>
        <enum-item name='LOADED'/>
        <enum-item name='SUBORDINATE'/>

        <enum-item name='PASSED_FIRST_REALIZATION'/>
        <enum-item name='SETTLED'/>
        <enum-item name='COMPLETELY_SUPERCEDED'/>
    </enum-type>

    <struct-type type-name='site_map_infost'>
        <enum name="lair_type" type-name='lair_type' init-value='NONE' comment='Only when site.type=LairShrine'/>
        <stl-vector name="lair_characteristic" type-name='lair_characteristic_type' comment="only on SIMPLE_MOUND and SIMPLE_BURROW"/>
        <int32_t name="entrance_x" init-value='-1000000'/>
        <int32_t name="entrance_y" init-value='-1000000'/>
        <int32_t name="entrance_z" init-value='-1000000'/>
    </struct-type>

    <enum-type type-name='infrastructure_type' base-type='int32_t'>
        <enum-item name='NONE' value='-1'/>
        <enum-item name='VILLAGE'/>
        <enum-item name='PASTURE'/>
        <enum-item name='MEADOW'/>
        <enum-item name='SMALL_CROPS'/>
        <enum-item name='ORCHARD'/>
        <enum-item name='WOODLAND'/>
        <enum-item name='WASTE'/>
        <enum-item name='TOWN'/>
    </enum-type>

    <struct-type type-name='world_site' key-field='id'
                 instance-vector='$global.world.world_data.sites'
                 original-name='sitest'>
        <compound name='name' type-name='language_name'/>

        <code-helper name='describe'>(describe-obj $.name)</code-helper>

        <int32_t name="civ_id" ref-target='historical_entity'/>
        <int32_t name="owner1" ref-target='historical_entity'/>
        <int32_t name="owner2" ref-target='historical_entity'/>

        <enum base-type='int16_t' name="type" type-name='world_site_type'/>

        <compound name='pos' type-name='coord2d'/>

        <int32_t name="id"/>

        <compound name='populace' type-name='populacest'/>

        <int32_t name="resource_pile_id"/>

        <int16_t name="rgn_min_x" comment='in embark tiles'/>
        <int16_t name="rgn_max_x"/>
        <int16_t name="rgn_min_y"/>
        <int16_t name="rgn_max_y"/>
        <int16_t name="rgn_min_z"/>
        <int16_t name="rgn_max_z"/>

        <int32_t name="global_min_x" comment='in embark tiles'/>
        <int32_t name="global_min_y"/>
        <int32_t name="global_max_x"/>
        <int32_t name="global_max_y"/>

        <uint32_t name="seed" comment='random'/>
        <uint32_t name="first_seed" comment='random'/>

        <int32_t name="size"/>
        <int32_t name="added_size"/>
        <int32_t name="infrastructure_pop_level"/>
        <int32_t name="base_infrastructure_pop_level"/>
        <static-array count='8' type-name='int32_t' index-enum='infrastructure_type' name="infrastructure"/>

        <stl-vector name='small_crop' pointer-type='site_cropst' comment='MountainHall, Town, DarkFortress, but not all'/>

        <df-flagarray name='flag' index-enum='site_flag_type'/>

        <stl-vector name="buildings" pointer-type='abstract_building'/>
        <int32_t name="next_building_id"/>

        <int32_t name="created_tick" comment='bay12: lastvisited not created'/>
        <int32_t name="created_year" comment='bay12: lastvisited not created'/>
        <int32_t name="moss_counter" comment='constant 0'/>
        <int32_t name="weathering_counter" comment='constant 0'/>

        <compound name='recorded_entrance' type-name='coord'/>

        <pointer name="realization" type-name='world_site_realization'/>

        <pointer name="subtype_info" type-name='site_map_infost' comment='bay12: site_map_info'/>

        <pointer name='resource_pile' type-name='resource_pilest'/>

        <compound name='temp_path' type-name='coord2d_path'/>
    </struct-type>

    <struct-type type-name='world_site_inhabitant' original-name='site_entity_populationst'>
        <int32_t name="count"/>
        <compound name='pop_spec' type-name='entity_pop_specifierst'/>
    </struct-type>

    <enum-type type-name='feature_layer_type' base-type='int16_t'> bay12: FeatureLayerType
        <enum-item name='NONE' value='-1'/>
        <enum-item name='SUBTERRANEAN'/>
        <enum-item name='MAGMA_CORE'/>
        <enum-item name='UNDERWORLD'/>
    </enum-type>

    <struct-type type-name='world_site_realization' original-name='site_realizationst'>
        <stl-vector name='nodes' pointer-type='site_realization_nodest'/>
        <stl-vector name='edges' pointer-type='site_realization_edgest'/>
        <stl-vector name='faces' pointer-type='site_realization_facest'/>
        <stl-vector name='buildings' pointer-type='site_realization_building'/>
        <int32_t name="num_buildings"/>
        <int32_t/>
        <int32_t/>
        <int32_t/>
        <static-array name='mini_tiles' count='17'>
            <static-array count='17' type-name='uint8_t'/>
        </static-array>
        <static-array name='mini_colors' count='17'>
            <static-array count='17' type-name='int16_t'
                          comment='bold shl 6|bg shl 3|fg'/>
        </static-array>
    </struct-type>

    <enum-type type-name='site_realization_building_type' base-type='int32_t'> bay12: SiteRealizationBuildingType
        Probably only a tiny fraction of these are used
        <enum-item name='cottage_plot'/>
        <enum-item name='castle_wall'/>
        <enum-item name='castle_tower'/>
        <enum-item name='castle_courtyard'/>
        <enum-item name='house'/>
        <enum-item name='temple'/>
        <enum-item name='tomb'/>
        <enum-item name='shop_house'/>
        <enum-item name='warehouse'/>
        <enum-item name='market_square'/>
        10
        <enum-item name='pasture'/>
        <enum-item name='waste'/>
        <enum-item name='courtyard'/>
        <enum-item name='well'/>
        <enum-item name='vault'/>
        <enum-item name='great_tower'/>
        <enum-item name='trenches'/>
        <enum-item name='tree_house'/>
        <enum-item name='hillock_house'/>
        <enum-item name='mead_hall'/>
        20
        <enum-item name='fortress_entrance'/>
        <enum-item name='library'/>
        <enum-item name='tavern'/>
        <enum-item name='counting_house'/>
        <enum-item name='guild_hall'/>
        <enum-item name='city_tower'/>
        <enum-item name='shrine'/>
        <enum-item name='meadow'/>
        <enum-item name='dormitory'/>
        <enum-item name='dininghall'/>
    </enum-type>

    <struct-type type-name='site_realization_nodest'>
        <int32_t name='id'/>
        <stl-vector name='neighbor' pointer-type='site_realization_nodest'/>
        <stl-vector name='edge' pointer-type='site_realization_edgest'/>
        <stl-vector name='face' pointer-type='site_realization_facest'/>
        <int32_t name='x'/>
        <int32_t name='y'/>
        <int32_t name='angle_1'/>
        <int32_t name='angle_2'/>
        <pointer name='a1_node' type-name='site_realization_nodest'/>
        <pointer name='a2_node' type-name='site_realization_nodest'/>
        <bool name='good_node'/>
    </struct-type>

    <struct-type type-name='site_realization_edgest'>
        <int32_t name='id'/>
        <pointer name='node_1' type-name='site_realization_nodest'/>
        <pointer name='node_2' type-name='site_realization_nodest'/>
        <pointer name='neighbor_face_1' type-name='site_realization_facest'/>
        <pointer name='neighbor_face_2' type-name='site_realization_facest'/>
        <bitfield name='flags' base-type='uint32_t'> bay12: SITE_REALIZATION_EDGE_FLAG_*
            <flag-bit name='main_road'/>
            <flag-bit name='sec_road'/>
            <flag-bit name='river'/>
        </bitfield>
    </struct-type>

    <struct-type type-name='site_realization_facest'>
        <int32_t name='id'/>
        <stl-vector name='neighbor' pointer-type='site_realization_nodest'/>
        <stl-vector name='edge' pointer-type='site_realization_edgest'/>
        <stl-vector name='face' pointer-type='site_realization_facest'/>
        <pointer name='neighbor_face_1' type-name='site_realization_facest'/>
        <pointer name='neighbor_face_2' type-name='site_realization_facest'/>
        <int32_t/>
        <int32_t/>
        <int32_t/>
        <int32_t/>
        <bitfield name='flags' base-type='uint32_t'> bay12: SITE_REALIZATION_FACE_FLAG_*
            <flag-bit name='tagged_for_resources'/>
        </bitfield>
        <int32_t/>
        <int32_t/>
        -- not saved
        <pointer/>
        <int32_t/>
        <int32_t/>
        <pointer/>
        <pointer/>
        <int8_t/>
    </struct-type>

    <enum-type type-name='site_realization_building_facing_type' base-type='int32_t'> bay12: SiteRealizationBuildingFacingType
        <enum-item name='NONE' value='-1'/>
        <enum-item name='UP'/>
        <enum-item name='RIGHT'/>
        <enum-item name='DOWN'/>
        <enum-item name='LEFT'/>
    </enum-type>

    <struct-type type-name='site_realization_building' original-name='site_realization_buildingst' key-field='id'>
        <int32_t name="id"/>

        <code-helper name='find-instance'>
            (find-by-id $(find-instance $world_site $$).realization.buildings $id $)
        </code-helper>

        <enum name='type' type-name='site_realization_building_type'/>

        <int32_t name="min_x" comment='in tiles relative to site'/>
        <int32_t name="min_y"/>
        <int32_t name="max_x"/>
        <int32_t name="max_y"/>

        <enum name='facing' type-name='site_realization_building_facing_type'/>
        <int32_t name="civzone_id" ref-target='building'/>
        <int32_t name="unk_id"/>
        <compound name='item' type-name='site_building_item'/>
        <int32_t name="abstract_building_id" comment='used for temple and mead hall'/>
        <pointer name="building_info" type-name='site_realization_building_infost'/>
    </struct-type>

    <class-type type-name='site_realization_building_infost'>
        <virtual-methods>
            <vmethod ret-type='site_realization_building_type' name='getType'/>
            <vmethod name='write_file'> <pointer name='file' type-name='file_compressorst'/> </vmethod>
            <vmethod name='read_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <int32_t name='loadversion'/>
            </vmethod>
            <vmethod is-destructor='true'/>
        </virtual-methods>
    </class-type>

    <struct-type type-name='site_building_item' comment='not a real structure'>
        <int32_t name="race" ref-target='creature_raw'/>
        <enum name='item_type' type-name='item_type'/>
        <int16_t name='item_subtype' refers-to='(item-subtype-target $$._parent.item_type $)'/>
        <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index'/>
        <int32_t name='mat_index'/>
    </struct-type>

    <bitfield-type type-name='tower_shape' base-type='uint32_t'> bay12: SRB_INFO_FLAG_CASTLE_TOWER_*
        <flag-bit name='round'/>
        <flag-bit name='hollow' comment='no internal floors or fortifications'/>
        <flag-bit name='keep' comment='fill with rooms at the bottom'/>
        <flag-bit name='use_relative_elevation' comment='ignore set heights and generate automatically'/>
        <flag-bit name='relative_elevation_to_highest_land' comment='set on goblin towers. doesnt seem to do anything'/>
    </bitfield-type>

    <class-type type-name='site_realization_building_info_castle_wallst'
                inherits-from='site_realization_building_infost'>
        <bitfield name='flags' base-type='uint32_t'> bay12: SRB_INFO_FLAG_CASTLE_WALL_*
            <flag-bit name='vertical'/>
            <flag-bit name='nw_fortified'/>
            <flag-bit name='se_fortified'/>
            <flag-bit name='central_gate'/>
        </bitfield>
<!-- Either this field or the one above is absent
        <int32_t name="door_pos"/>
-->
        <int32_t name="start_x"/>
        <int32_t name="start_y"/>
        <int32_t name="start_z"/>
        <int32_t name="end_x"/>
        <int32_t name="end_y"/>
        <int32_t name='end_z'/>
        <compound name='wall_item' type-name='site_building_item'/>
        <compound name='door_item' type-name='site_building_item'/>
    </class-type>

    <class-type type-name='site_realization_building_info_castle_towerst'
                inherits-from='site_realization_building_infost'>
        <int32_t name='roof_z'/>
        <int32_t name="base_z" comment="can be below ground, but not above ground"/>
        <int32_t name="door_n_elevation"/>
        <int32_t name="door_s_elevation"/>
        <int32_t name="door_e_elevation"/>
        <int32_t name="door_w_elevation"/>
        <compound name='door_item' type-name='site_building_item'/>
        <compound name='wall_item' type-name='site_building_item'/>
        <bitfield name='shape' type-name='tower_shape'/>
    </class-type>

    <class-type type-name='site_realization_building_info_castle_courtyardst'
                inherits-from='site_realization_building_infost'/>

</data-definition>

<!--
Local Variables:
indent-tabs-mode: nil
nxml-child-indent: 4
End:
-->
