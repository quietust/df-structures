<data-definition>
    <enum-type type-name='worldgen_range_type'> bay12: RegionField
        <enum-item name='ELEVATION'/>
        <enum-item name='RAINFALL'/>
        <enum-item name='VEGETATION'/>
        <enum-item name='TEMPERATURE'/>
        <enum-item name='EVIL'/>
        <enum-item name='DRAINAGE' comment='GEOLOGY'/>
        <enum-item name='VOLCANISM'/>
        <enum-item name='SAVAGERY'/>
        <enum-item name='AIRMASS_TEMP'/>
        <enum-item name='AIRMASS_X'/>
        <enum-item name='AIRMASS_Y'/>
        <enum-item name='WEATHER'/>
        <enum-item name='DAILY_WINDS'/>
        <enum-item name='SNOWFALL'/>
        <enum-item name='SALINITY'/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
    </enum-type>

    <enum-type type-name='units_other_id'>
        <enum-item name='ANY_RIDER'/>
        <enum-item name='ANY_BABY'/>
        <enum-item name='ANY_BABY2'/>
    </enum-type>

    <struct-type type-name='ocean_wave_maker' original-name='event_ocean_wave_generatorst'>
        <compound type-name='coord' name='pos'/>
        <int8_t name='interval'/>
        <compound name='coastline' type-name='coord2d_path'/>
        <compound name='wave_origin' type-name='coord2d_path'/>
    </struct-type>

    <struct-type type-name='coord_rect' original-name='event_swampst'>
        <int16_t name='x1'/>
        <int16_t name='y1'/>
        <int16_t name='x2'/>
        <int16_t name='y2'/>
        <int16_t name='z'/>
    </struct-type>

    <struct-type type-name='embark_feature' original-name='event_populationst' comment="layers plus river seen">
        <compound type-name='coord2d' name='world_tile'/>
        <compound type-name='coord2d' name='mid_level_tile' comment="the MLT the feature resides in"/>
        <int16_t name='local_feature_idx'/>
        <int32_t name='global_feature_idx' ref-target='world_underground_region'/>
        <int32_t name='global_feature_sq'/>
        <enum name='layer' type-name='layer_type' base-type='int16_t'/>
        <compound type-name='coord2d' name='local' comment="the top left corner of the MLT, in embark relative coordinates"/>
        <int16_t name='z_min'/>
        <int16_t name='z_max'/>
    </struct-type>

    <enum-type type-name='combat_report_event_type' base-type='int16_t'> bay12: CombatEventType
        <enum-item name='StruckItem'/>
        <enum-item name='Deflected'/>
        <enum-item name='ThroughTissue'/>
        <enum-item name='CompoundFracture'/>
        <enum-item name='BrokenAway'/>
        <enum-item name='BasicWound'/>
        <enum-item name='Unconscious'/>
        <enum-item name='Stunned'/>
        <enum-item name='MoreStunned'/>
        <enum-item name='Winded'/>
        <enum-item name='MoreWinded'/>
        <enum-item name='Nausea'/>
        <enum-item name='MoreNausea'/>
        <enum-item name='SeveredPart'/>
        <enum-item name='PopOut'/>
        <enum-item name='ExtractInjected'/>
        <enum-item name='ExtractSprayed'/>
        <enum-item name='BloodSucked'/>
        <enum-item name='StrikeInto'/>
        <enum-item name='GrabGlances'/>
        <enum-item name='KnockedBack'/>
        <enum-item name='StuckIn'/>
        <enum-item name='LatchOnPart'/>
        <enum-item name='LatchOn'/>
        <enum-item name='Enraged'/>
        <enum-item name='PassThrough'/>
        <enum-item name='GlancesAway'/>
        <enum-item name='TendonDamaged'/>
        <enum-item name='LigamentDamaged'/>
        <enum-item name='MajorArtery'/>
        <enum-item name='Artery'/>
        <enum-item name='MotorNerve'/>
        <enum-item name='SensoryNerve'/>
        <enum-item name='NoForce'/>
    </enum-type>

    <struct-type type-name='glowing_barrier' original-name='event_underworld_building_monitorst'>
        <uint8_t name='triggered' comment='set when the glowing barrier vanishes, preventing later HFS events'/>
        <int32_t name='age' comment='divide by 100800, add 1, then multiply by 20 to get number of demons to summon (min 10, max 100)'/>
        <stl-vector name='buildings' type-name='int32_t' ref-target='building' comment='when building is deconstructed, causes glowing barrier at pos to vanish and (in fort mode) spawns HFS one z-level below if it has not been set off already'/>
        <compound name='pos' type-name='coord' comment='coordinates of a GlowingBarrier or GlowingFloor tiletype'/>
    </struct-type>

    <struct-type type-name='deep_vein_hollow' original-name='event_underworld_tube_breach_monitorst'>
        <uint8_t name='triggered' comment='set when the underworld spire is breached, preventing subsequent HFS events'/>
        <int32_t name='age' comment='divide by 100800, add 1, then multiply by 20 to get number of demons to summon (min 10, max 100)'/>
        <compound name='tiles' type-name='coord_path' comment='tile coordinates correspond to open spaces within an underworld spire; revealing one of these tiles triggers the HFS demon wave'/>
        <compound name='pos' type-name='coord' comment='announcement zoom location'/>
    </struct-type>

    <struct-type type-name='campfire' original-name='event_campfirest'>
        <compound type-name='coord' name='pos'/>
        <int32_t name='timer'/>
    </struct-type>

    <struct-type type-name='web_cluster' original-name='event_webst'>
        <stl-vector type-name='int16_t' name='x'/>
        <stl-vector type-name='int16_t' name='y'/>
        <int16_t name='z'/>
        <int16_t name='race' ref-target='creature_raw'/>
        <int16_t name='caste' ref-target='caste_raw' aux-value='$$.race' />
        <compound type-name='coord2d' name='pos_min'/>
        <compound type-name='coord2d' name='pos_max'/>
        <stl-vector type-name='int32_t' name='ambushers' ref-target='unit'/>
    </struct-type>

    <struct-type type-name='fire' original-name='event_firest'>
        <compound type-name='coord' name='pos'/>
        <int16_t name='timer'/>
        <uint16_t name='inner_temp_cur' init-value='10508' comment='applied to own tile'/>
        <uint16_t name='outer_temp_cur' init-value='10000' comment='applied to neighboring tiles'/>
        <uint16_t name='inner_temp_max' init-value='10708'/>
        <uint16_t name='outer_temp_max' init-value='10708'/>
    </struct-type>

    <struct-type type-name='ocean_wave' original-name='event_ocean_wave_frontst'>
        <compound type-name='coord2d' name='dest'/>
        <compound type-name='coord2d' name='cur'/>
        <int16_t name='z'/>
        <int8_t name='spawn_flows' comment='set once the wave reaches the coast'/>
        <int8_t name='move_timer'/>
        <int8_t name='vis_duration' comment='starts at 120 and randomly decrements'/>
    </struct-type>

    <struct-type type-name='coin_batch' original-name='coinbatchst' instance-vector='$global.world.coin_batches'>
        <int32_t name='year'/>
        <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index'/>
        <int32_t name='mat_index'/>
        <int32_t name='entity' ref-target='historical_entity'/>
        <int32_t name='ruler' ref-target='historical_figure'/>
        <compound name='image_front'> not a compound
            <int32_t name='id' ref-target='art_image_chunk'/>
            <int16_t name='subid' ref-target='art_image' aux-value='$$.id'/>
        </compound>
        <compound name='image_back'> not a compound
            <int32_t name='id' ref-target='art_image_chunk'/>
            <int16_t name='subid' ref-target='art_image' aux-value='$$.id'/>
        </compound>
    </struct-type>

    <struct-type type-name='job_handler' original-name='job_handlerst'>
        <df-linked-list name='list' type-name='job_list_link'/>
    </struct-type>

    <struct-type type-name='building_handler' original-name='building_handlerst'>
        <stl-vector name='all' pointer-type='building' comment='bay12: global'/>

        <static-array name='other' count='86' index-enum='buildings_other_id' comment='not a compound in bay12'>
            <stl-vector pointer-type='building'/>
        </static-array>

        <stl-vector name='temp_save' has-bad-pointers='true' pointer-type='building'/>

        <bool name='check_bridge_collapse' comment='bay12: evaluate_bridge_stability'/>
        <bool name='check_machine_collapse' comment='bay12: evaluate_machine_stability'/>
    </struct-type>


    <struct-type type-name='machine_handler' original-name='machine_handlerst'>
        <stl-vector name='all' pointer-type='machine'/>
        <stl-vector name='temp_save' has-bad-pointers='true' pointer-type='machine'/>
    </struct-type>

    <enum-type type-name='unit_reaction_type' base-type='int8_t'> bay12: UnitReactionType
        <enum-item name='NONE' value='-1'/>
        <enum-item name='STRANGER'/>
        <enum-item name='GOOD_FAMILY'/>
        <enum-item name='MURDERER'/>
        <enum-item name='MYSELF'/>
        <enum-item name='CANNOT_BECAUSE_IT_IS_ETHEREAL'/>
        <enum-item name='CANNOT_BECAUSE_IT_IS_INACCESSIBLE'/>
        <enum-item name='EQUIPMENT'/>
        <enum-item name='CANNOT_BECAUSE_I_AM_ETHEREAL'/>
        <enum-item name='ARENA_TARGET'/>
        <enum-item name='ARENA_BUDDY'/>
        <enum-item name='I_AM_CHAINED_AND_YOU_ARE_LCU'/>
        <enum-item name='I_AM_LED_AND_YOU_ARE_LCU'/>
        <enum-item name='I_AM_LCU_AND_YOU_ARE_CHAINED'/>
        <enum-item name='I_AM_LCU_AND_YOU_ARE_LED'/>
        <enum-item name='SOMEBODY_IS_CRAZE'/>,
        <enum-item name='NOT_LIVING_IS_FINE'/>
        <enum-item name='LIVING_MUST_BE_KILLED'/>
        <enum-item name='EVIL_DEAD'/>
        <enum-item name='WE_ARE_SAME_RACE_WILDERNESS_ANIMALS'/>
        <enum-item name='PREDATOR_OR_PREY'/>
        <enum-item name='BENIGN_ANIMAL'/>
        <enum-item name='DANGEROUS_ANIMAL'/>
        <enum-item name='NEIGHBOR'/>
        <enum-item name='YOU_ARE_MY_PRISONER'/>
        <enum-item name='MASTER'/>
        <enum-item name='APPRENTICE'/>
        <enum-item name='TRAVELING_COMPANION'/>
        <enum-item name='LOVER'/>
        <enum-item name='HATED_GROUP'/>
        <enum-item name='ENEMY_FIGHTER'/>
        <enum-item name='MONSTER'/>
        <enum-item name='FORMER_MASTER'/>
        <enum-item name='FORMER_APPRENTICE'/>
        <enum-item name='SAME_CULTURE'/>
        <enum-item name='INTRUDER'/>
    </enum-type>

    <struct-type type-name='formationst'>
        <int32_t name='id'/>
    </struct-type>

    <struct-type type-name='world' original-name='worldst'>
        <compound name='event'> bay12: event_handlerst
            <stl-vector name='glowing_barriers' pointer-type='glowing_barrier' comment='bay12: underworld_building_monitor'/>
            <stl-vector name='deep_vein_hollows' pointer-type='deep_vein_hollow' comment='bay12: underworld_tube_breach_monitor'/>
            <stl-vector name='engravings' pointer-type='engraving' comment='bay12: detail'/>
            <stl-vector name='vermin' pointer-type='vermin' comment='bay12: vermin'/>
            <stl-vector name='vermin_colonies' pointer-type='vermin' comment='bay12: vermin_colony'/>
            <stl-vector name='dirty_waters' pointer-type='coord' comment="bay12: water; for making blood flow downstream in rivers, but also includes mud in artificial water channels"/>
            <stl-vector name='campfires' pointer-type='campfire' comment='bay12: campfire'/>
            <stl-vector name='web_clusters' pointer-type='web_cluster' comment='bay12: web'/>
            <stl-vector name='fires' pointer-type='fire' comment='bay12: fire'/>
            <stl-vector name='ocean_wave_makers' pointer-type='ocean_wave_maker' comment='bay12: ocean_wave_generator'/>
            <stl-vector name='ocean_waves' pointer-type='ocean_wave' comment='bay12: ocean_wave_front'/>
            <stl-vector name='constructions' pointer-type='construction' comment='bay12: construction'/>
            <stl-vector name='murky_pools' pointer-type='coord_rect' comment='bay12: swamp'/>
            <stl-vector name='embark_features' pointer-type='embark_feature' comment="bay12: population; populated at embark"/>

            <!-- bay12: "THESE ARE USED DURING SITE SAVE/LOAD" -->
            <stl-vector name='temp_save_glowing_barriers' pointer-type='glowing_barrier' comment='bay12: temp_save_underworld_building_monitor'/>
            <stl-vector name='temp_save_deep_vein_hollows' pointer-type='deep_vein_hollow' comment='bay12: temp_save_underworld_tube_breach_monitor'/>
            <stl-vector name='temp_save_engravings' pointer-type='engraving' comment='bay12: temp_save_detail'/>
            <stl-vector name='temp_save_constructions' pointer-type='construction' comment='bay12: temp_save_construction'/>
            <stl-vector name='temp_save_embark_features' pointer-type='embark_feature' comment='bay12: temp_save_population'/>
            <stl-vector name='temp_save_ocean_wave_makers' pointer-type='ocean_wave_maker' comment='bay12: temp_save_ocean_wave_generator'/>
            <stl-vector name='temp_save_murky_pools' pointer-type='coord_rect' comment='bay12: temp_save_swamp'/>
        </compound>

        bay12: effect_handlerst
        <stl-vector name='effects' pointer-type='effect_info'/>

        bay12: coinbatch_handlerst
        <stl-vector name='coin_batches' pointer-type='coin_batch'/>

        bay12: wilderpop_handlerst
        <stl-vector name='populations' pointer-type='local_population'/>

        --
        <compound name='manager_orders'> bay12: workquota_handlerst
            <stl-vector name='all' pointer-type='manager_order'/>
        </compound>

        bay12: mandate_handlerst
        <stl-vector name='mandates' pointer-type='mandate'/>

        --  Entities

        <compound name='entities'> bay12: entity_handlerst
            <stl-vector name='all' pointer-type='historical_entity'/>

            <stl-vector name='order_load' has-bad-pointers='true' pointer-type='historical_entity'/>

            -- Apparently a temporary buffer for world construction stuff
            <static-array count='20000' type-name='coord2d' name='slots'/>
            <int16_t name='next_slot'/>
        </compound>

        -- Units

        <compound name='units'> bay12: unit_handlerst
            <stl-vector name='all' pointer-type='unit'/>

            <stl-vector name='active' pointer-type='unit' comment='not sorted, entry 0 is adventurer'/>

            <static-array name='other' count='3' index-enum='units_other_id' comment='not a compound in bay12'>
                <stl-vector pointer-type='unit'/>
            </static-array>

            <stl-vector name='temp_save' has-bad-pointers='true' pointer-type='unit'/>
        </compound>

        -- Unit and Art Chunks

        bay12: unit_chunk_handlerst
        <stl-vector name='unit_chunks' pointer-type='unit_chunk'/>
        bay12: art_image_chunk_handlerst
        <stl-vector name='art_image_chunks' pointer-type='art_image_chunk'/>

        -- Nemesis

        <compound name='nemesis'> bay12: nemesis_handlerst
            <stl-vector name='all' pointer-type='nemesis_record'/>
            <stl-vector name='order_load' has-bad-pointers='true' pointer-type='nemesis_record'/>
            <bool name='do_not_remove_from_vector'/>
        </compound>

        -- Items

        <compound name='items'> bay12: item_handlerst
            <stl-vector name='all' pointer-type='item'/>

            <static-array name='other' count='127' index-enum='items_other_id' comment='not a compound in bay12'>
                <stl-vector pointer-type='item'/>
            </static-array>

            <stl-vector name='temp_save' has-bad-pointers='true' pointer-type='item'/>

            <stl-vector name='temp_save_compat' type-name='int32_t'/>
        </compound>

        -- Artifacts

        <compound name='artifacts'> bay12: artifact_handlerst
            <stl-vector name='all' pointer-type='artifact_record'/>

            <stl-vector name='order_load' has-bad-pointers='true' pointer-type='artifact_record'/>
        </compound>

        -- Jobs and projectiles

        <compound name='jobs' type-name='job_handler'/>

        bay12: proj_handlerst
        <df-linked-list name='proj_list' type-name='proj_list_link'/>

        -- Buildings

        <compound name='buildings' type-name='building_handler'/>

        -- Machines (connected groups of gears and so on)

        <compound name='machines' type-name='machine_handler'/>

        -- Flow guides (whatever those are)

        <compound name='flow_guides'> bay12: flow_guide_handlerst
            <stl-vector name='all' pointer-type='flow_guide'/>
            <stl-vector name='temp_save' pointer-type='flow_guide' has-bad-pointers='true'/>
        </compound>

        -- Stockpile classifier

        <compound name='stockpile'> bay12: storage_handlerst
            <static-array type-name='int32_t' name='num_jobs' count='10' index-enum='hauler_type'/>
            <static-array type-name='int32_t' name='num_haulers' count='10' index-enum='hauler_type'/>

            <int8_t name='barreltype'/>
            <int8_t name='barreltype_food'/>
            <stl-vector name='seeds' type-name='int8_t'
                        index-refers-to='(find-plant-raw $)'/>
            <stl-vector name='plants' type-name='int8_t'
                        index-refers-to='(find-plant-raw $)'/>
            <stl-vector name='cheese' type-name='int8_t'
                        index-refers-to='(find-creature $)'/>
            <stl-vector name='meat_fish' type-name='int8_t'
                        index-refers-to='(find-creature $)'/>
            <stl-vector name='eggs' type-name='int8_t'
                        index-refers-to='(find-creature $)'/>
            <stl-vector name='leaves' type-name='int8_t'
                        index-refers-to='(find-plant-raw $)'/>
            <stl-vector name='plant_powder' type-name='int8_t'
                        index-refers-to='(find-plant-raw $)'/>
            <int8_t name='barreltype_seeds_mix'/>
            <int8_t name='barreltype_plants_mix'/>
            <int8_t name='barreltype_cheese_mix'/>
            <int8_t name='barreltype_fish_mix'/>
            <int8_t name='barreltype_meat_mix'/>
            <int8_t name='barreltype_leaves_mix'/>
            <int8_t name='barreltype_powder_mix'/>
            <int8_t name='barreltype_eggs_mix'/>
            <stl-vector name='liquid_plant' type-name='int8_t'
                        index-refers-to='(find-plant-raw $)'/>
            <stl-vector name='liquid_animal' type-name='int8_t'
                        index-refers-to='(find-creature $)'/>
            <stl-vector name='liquid_builtin' type-name='int8_t'
                        index-refers-to='(material-by-id $ -1)'/>
            <int8_t name='barreltype_glob_fat'/>
            <int8_t name='barreltype_glob_tallow'/>
            <int8_t name='barreltype_glob_paste'/>
            <int8_t name='barreltype_glob_pressed'/>
            <int8_t name='bintype_weapon'/>
            <int8_t name='bintype_armor'/>
            <int8_t name='bintype_ammo'/>
            <int8_t name='bintype_coins'/>
            <int8_t name='bintype_barblock'/>
            <int8_t name='bintype_gem' comment='not large'/>
            <int8_t name='bintype_finished'/>
            <int8_t name='bintype_leather'/>
            <int8_t name='bintype_cloth'/>
            <int8_t name='bintype_sheet'/>
        </compound>

        -- Plants

        <compound name='plants'> bay12: veg_handlerst
            <stl-vector name='all' pointer-type='plant'/>
            <stl-vector name='shrub_dry' pointer-type='plant'/>
            <stl-vector name='shrub_wet' pointer-type='plant'/>
            <stl-vector name='tree_dry' pointer-type='plant'/>
            <stl-vector name='tree_wet' pointer-type='plant'/>
            <stl-vector name='temp_save' pointer-type='plant' has-bad-pointers='true'/>
        </compound>

        -- Tasks

        <df-linked-list name='task_list' type-name='task_list_link'/>

        -- Unit Reactions

        <compound name='enemy_status_cache'> bay12: unit_reaction_handlerst
            <static-array name='slot_used' type-name='bool' count='500'/>
            <static-array name='rel_map' count='500'>
                <static-array type-name='unit_reaction_type' count='500'/> bay12: unit_reactionst
            </static-array>
            <int32_t name='next_slot'/>
        </compound>

        <compound name='schedules'> bay12: schedule_handlerst
            <stl-vector name='all' pointer-type='schedule_info' />
            <stl-vector name='temp_save' pointer-type='schedule_info' has-bad-pointers='true' />
        </compound>

        <compound name='squads'> bay12: squad_handlerst
            <stl-vector name='all' pointer-type='squad'/>
            <stl-vector name='order_load' has-bad-pointers='true' pointer-type='squad'/>
        </compound>

        <compound name='formations'> bay12: formation_handlerst
            <stl-vector name='all' pointer-type='formationst'/>
            <stl-vector name='order_load' pointer-type='formationst' has-bad-pointers='true'/>
        </compound>

        -- Drills

        <compound name='activities'> bay12: activity_handlerst
            <stl-vector name='all' pointer-type='activity_entry'/>
            <stl-vector name='order_load' has-bad-pointers='true' pointer-type='activity_entry'/>
        </compound>

        -- Reports and announcements

        <compound name='status'> bay12: announcement_handlerst
            <stl-vector name='reports' pointer-type='report'/>
            <stl-vector name='announcements' pointer-type='report'/>
            <stl-vector name='popups' pointer-type='popup_message'/>

            <int32_t name='next_report_id'/>
            <bitfield name='flags' base-type='uint32_t'> bay12: REPORT_FLAG_*
                <flag-bit name='combat'/>
                <flag-bit name='hunting'/>
                <flag-bit name='sparring'/>
            </bitfield>
            <int32_t name='display_timer' comment='bay12: announcetime'/>

            <compound name='slots'> bay12: combat_event_listst
                <static-array name='slotdata' count='100'> bay12: combat_eventst
                    <enum type-name='combat_report_event_type' name='type'/>
                    <static-array name='field1' type-name='int32_t' count='4' comment='varies by event type'/>
                    <static-array name='field2' type-name='int16_t' count='4' comment='varies by event type'/>
                    <static-array name='str' type-name='stl-string' count='4'/>
                    <bitfield name='flags' base-type='uint32_t'> bay12: COMBAT_EVENT_STRIKE_INTRO_FLAG_*
                        <flag-bit name='behind'/>
                        <flag-bit name='side'/>
                        <flag-bit name='grapple'/>
                        <flag-bit name='item'/>
                        <flag-bit name='tap'/>
                        <flag-bit name='passive'/>
                        <flag-bit name='liquipowder'/>
                    </bitfield>
                </static-array>
                <static-array name='slot_id_used' type-name='int16_t' count='34' index-enum='combat_report_event_type'/>
                <static-array name='slot_id_idx1' type-name='int16_t' count='34' index-enum='combat_report_event_type'/>
                <static-array name='slot_id_idx2' type-name='int16_t' count='34' index-enum='combat_report_event_type'/>
                <int16_t name='slots_used'/>
            </compound>
        </compound>

        <pointer name='selected_building' type-name='building'/>
        <enum base-type='int16_t' name='selected_stockpile_type' type-name='stockpile_category'/>
        <bool name='update_selected_building'/>
        <int16_t name='building_width'/>
        <int16_t name='building_height'/>
        <enum name='selected_direction' base-type='int8_t' type-name='screw_pump_direction'/>

        <compound name='map'> not a compound, beware of alignment problems
            <stl-vector name='map_blocks' pointer-type='map_block'/>
            <pointer name='block_index' is-array='true'>
                <pointer is-array='true'>
                    <pointer is-array='true'>
                        <pointer type-name='map_block'/>
                    </pointer>
                </pointer>
            </pointer>

            <stl-vector name='map_block_columns' pointer-type='map_block_column'/>
            <pointer name='column_index' is-array='true'>
                <pointer is-array='true'>
                    <pointer type-name='map_block_column'/>
                </pointer>
            </pointer>

            <int32_t name='x_count_block'/>
            <int32_t name='y_count_block'/>
            <int32_t name='z_count_block'/>
            <int32_t name='x_count'/>
            <int32_t name='y_count'/>
            <int32_t name='z_count'/>
            <int32_t name='region_x'/>
            <int32_t name='region_y'/>
            <int32_t name='region_z'/>
            <static-array name='distance_lookup' count='53' comment='bay12: lightrad'>
                <static-array count='53' type-name='int16_t'
                              comment='Appears to be precomputed rounded integer distances'/>
            </static-array>
            <int8_t name='map_rotation'/>
        </compound>

        <pointer name='world_data' type-name='world_data'/>

        <compound name='worldgen_status'> bay12: world_generatorst
            <enum base-type='int16_t' name='state'>
                <enum-item name='None' value='-1'/>
                <enum-item name='Initializing'/>
                <enum-item name='PreparingElevation'/>
                <enum-item name='SettingTemperature'/>
                <enum-item name='RunningRivers'/>
                <enum-item name='FormingLakesAndMinerals'/>
                <enum-item name='GrowingVegetation'/>
                <enum-item name='VerifyingTerrain'/>
                <enum-item name='ImportingWildlife'/>
                <enum-item name='RecountingLegends'/>
                <enum-item name='Finalizing'/>
                <enum-item name='Done'/>
            </enum>
            <int32_t name='num_rejects'/>
            <static-array name='skip_reject' count='52' type-name='int32_t'/>
            <static-array name='reject_type' count='52' type-name='int32_t'/>
            <int16_t name='rejection_reason'/>
            <int32_t name='new_dimx'/>
            <int32_t name='new_dimy'/>
            <int16_t name='unk_1b4'/>
            <int32_t name='lake_x'/>
            <int32_t name='geoindex'/>
            <int32_t name='max_geo_index'/>
            <static-array name='geo_layers' count='100' pointer-type='world_geo_layer'/>
            <static-array name='placement_freq' count='100' type-name='int8_t'/>
            <static-array name='placement_parent' count='100' type-name='int16_t'/>
            <bool name='have_logged_parameters'/>
            <int32_t name='finalized_civ_mats'/>
            <int32_t name='finalized_art'/>
            <int32_t name='finalized_uniforms'/>
            <int32_t name='finalized_sites'/>
            <int32_t name='unk_494'/>
            <int32_t name='unk_498'/>
            <stl-vector name='entities' pointer-type='historical_entity'/>
            <stl-vector name='sites' pointer-type='world_site'/>
            <int32_t name='cursor_x'/>
            <int32_t name='cursor_y'/>
            <compound name='riverstart' type-name='coord2d_path'/>
            <int32_t name='rivers_total'/>
            <int32_t name='rivers_cur'/>
            <int8_t name='last_used_valid'/>
            <stl-string name='last_param_set'/>
            <int32_t name='last_seed'/>
            <int32_t name='last_name_seed'/>
            <int32_t name='last_history_seed'/>
            <int32_t name='last_creature_seed'/>
            <bool name='prehistory_initialized'/>
            <bool name='placed_caves'/>
            <bool name='placed_good_evil'/>
            <bool name='placed_megabeasts'/>
            <bool name='placed_other_beasts'/>
            <bool name='made_cave_pops'/>
            <bool name='made_cave_civs'/>
            <bool name='finished_prehistory'/>
            <stl-vector name='caves' pointer-type='world_site'/>
            <stl-vector name='orig_cave' pointer-type='world_site'/>
            <int32_t name='current_bandit_num'/>
            <bool name='have_placed_controllable'/>
            <bool name='placed'/>
            <bool name='skip_controllable'/>
            <bool name='just_continued'/>
            <stl-vector name='entity_raws' pointer-type='entity_raw'/>
            <stl-vector name='entity_race' type-name='int16_t'/>
            <int32_t name='civ_count'/>  --  Only valid during civ placement phase
            <int32_t name='civs_left_to_place'/>  --  Ditto
            <static-array name='normal_regions' count='10'>
                <stl-vector pointer-type='world_region'/>
            </static-array>
            <static-array name='good_regions' count='10'>
                <stl-vector pointer-type='world_region'/>
            </static-array>
            <static-array name='evil_regions' count='10'>
                <stl-vector pointer-type='world_region'/>
            </static-array>
            <stl-vector name='cave_choice_x' type-name='int32_t'/>
            <stl-vector name='cave_choice_y' type-name='int32_t'/>
            <stl-vector name='final_cave_choice_x' type-name='int32_t'/>
            <stl-vector name='final_cave_choice_y' type-name='int32_t'/>
            <stl-vector name='o_final_cave_choice_x' type-name='int32_t'/>
            <stl-vector name='o_final_cave_choice_y' type-name='int32_t'/>
            <int32_t name='mountain_cave_left'/>
            <int32_t name='non_mountain_cave_left'/>
        </compound>

        <compound name='orphaned_flow_pool' type-name='flow_reuse_pool'/>

        -- raws

        <compound name='raws' type-name='world_raws'/> NOT A COMPOUND!

        <compound name='area_grasses' comment="grasses in world tiles around embark. Populated at embark"> not a compound
            <compound name='world_tiles' type-name='coord2d_path' comment="local_wilderpop"/>
            <stl-vector name='layer_grasses' comment="one per layer per world tile">
                <pointer> bay12: grass_selectionst
                    <compound name='ref' type-name='world_population_ref'/>
                    <stl-vector name='grasses'>
                        <int32_t ref-target='plant_raw'/>
                    </stl-vector>
                </pointer>
            </stl-vector>
        </compound>

        <compound name='flow_engine'> not a compound
            <int8_t name='rnd_16' comment='flow_direction'/>
            <int16_t name='rnd_256' comment='flow_index'/>
            <int16_t name='rnd_pos' comment='flow_index_count'/>
            <static-array name='rnd_x' type-name='int16_t' count='16'/>
            <static-array name='rnd_y' type-name='int16_t' count='16'/>

            <int32_t name='block_idx' refers-to='$$._global.map.map_blocks[$]'/>

            <compound name='sink_checked' type-name='coord_path'/>
            <stl-vector name='sink_checked_timer' type-name='int16_t'/>
        </compound>

        bay12: building_use_controllerst
        <stl-vector name='busy_buildings' type-name='int32_t' ref-target='building'
                    comment='buildings with nonempty getUsers'/>

        <df-flagarray name='flags' index-enum='world_flags'/>
        <int32_t name='original_save_version' comment='DF version on which the world was first created'/>

        <compound name='worldgen'> not a compound
            <stl-string name='version'/>
            <int32_t name="next_unit_chunk_id"/>
            <int16_t name="next_unit_chunk_offset"/>
            <int32_t name="next_art_image_chunk_id"/>
            <int16_t name="next_art_image_chunk_offset"/>

            <compound name='worldgen_parms' type-name='worldgen_parms'/>
        </compound>

        -- hist figures

        <compound name='history' type-name='world_history'/>

        <stl-vector name='entity_populations' pointer-type='entity_population'/>

        <bool name="reindex_pathfinding" comment='forces map_block.passable to be recomputed'/>

        <int32_t name='frame_counter' comment='increases by 1 every time . is pressed'/>

        <stl-vector name='orphaned_flows' pointer-type='flow_info' comment='flows that are not tied to a map_block'/>

        <compound name='pathfinder'> not a compound
            <compound name='heap'> bay12: open_list_binary_heapst
                <static-array name='boundary_heap' count='80000'> bay12: open_list_nodest
                <comment>Looks like a temporary buffer for pathfinding or something.</comment>
                    <comment>A heap of current boundary tiles.</comment>
                    <int32_t name='total_cost'/>
                    <int32_t name='local_cost'/>
                    <int16_t name='x'/>
                    <int16_t name='y'/>
                    <int16_t name='z'/>
                </static-array>
                <int32_t name='heap_count'/>

                <compound name='pos1' type-name='coord'/>
                <compound name='pos2' type-name='coord'/>

                -- Not quite simple distance, it seems:
                <int32_t name='dist_x'/>
                <int32_t name='dist_y'/>
                <int32_t name='dist_z'/>
            </compound>

            <int32_t name='pathstart'/>
            <int8_t name='pathclear'/>
            <uint16_t name='direction_start'/>
            <int8_t name='direction_clear'/>
            <int16_t name='next_levelmap'/>
            <int16_t name='cur_veg_move_stage'/>
            <bool name='preparing_map'/>
        </compound>

        <int32_t name='save_version'/>

        <compound name='cur_savegame'> not a compound
            <stl-string name='save_dir'/>
            <bool name='civ_history_complete'/>
            <bool name='must_end_civ_history'/>
        </compound>

        <compound name='features'> not a compound
            <stl-vector name='map_features' pointer-type='feature_init'/>
            <stl-vector type-name='int16_t' name='feature_x'/>
            <stl-vector type-name='int16_t' name='feature_y'/>
            <stl-vector type-name='int16_t' name='feature_local_idx' comment='same as map_block.local_feature'/>
            <stl-vector type-name='int32_t' name='feature_global_idx' ref-target='world_underground_region'/>

            <stl-vector pointer-type='feature_init' name='newpop_feature'/>
            <stl-vector type-name='int16_t' name='newpop_ax'/>
            <stl-vector type-name='int16_t' name='newpop_ay'/>
            <stl-vector type-name='int16_t' name='newpop_dx'/>
            <stl-vector type-name='int16_t' name='newpop_dy'/>
            <stl-vector type-name='int16_t' name='newpop_feature_ind'/>
            <stl-vector type-name='int32_t' name='newpop_feature_layer'/>
            <stl-vector type-name='int32_t' name='newpop_feature_layer_sq'/>
            <stl-vector type-name='int16_t' name='newpop_layer_depth'/>
            <stl-vector type-name='int16_t' name='newpop_sx'/>
            <stl-vector type-name='int16_t' name='newpop_sy'/>
            <stl-vector type-name='int16_t' name='newpop_min_z'/>
            <stl-vector type-name='int16_t' name='newpop_mid_z'/>
            <stl-vector type-name='int16_t' name='newpop_max_z'/>
        </compound>

        <bool name='allow_announcements' comment='announcements will not be processed at all if false'/>
        <bool name='suppress_minevent_announcements'/>

        <compound name='arena'> bay12: arenast
            <stl-vector name='race' type-name='int16_t' ref-target='creature_raw'/>
            <stl-vector name='caste' type-name='int16_t' ref-target='caste_raw' aux-value='$$._parent.race[$._key]'/>

            <int16_t name='last_selected_race_cast' comment='index into the above two vectors'/>

            <compound type-name='embark_item_choice' name='item_types'/>

            <stl-vector name='skills' type-name='job_skill'/>
            <stl-vector name='skill_levels' type-name='int32_t' index-refers-to='$$._parent.skills[$]'/>

            <compound name='equipment'> not a compound
                <stl-vector name='item_types' type-name='item_type'/>
                <stl-vector name='item_subtypes'>
                    <int16_t refers-to='(item-subtype-target $$._parent._parent.item_types[$$._key] $)'/>
                </stl-vector>
                <compound name='item_materials' type-name='material_vec_ref'/>
                <stl-vector name='item_counts' type-name='int32_t'/>
            </compound>

            <int32_t name='last_side'/>
            <int32_t name='last_undead_mode'/>

            <stl-vector name='creature_cnt' type-name='int32_t'
                        index-refers-to='(find-instance $creature_raw $)'/>
        </compound>

        <compound name='attack_chance_info'> bay12: attack_chance_infost
            <stl-vector name='modifier' pointer-type='attack_chance_modifierst'/>
            <stl-vector name='attack'>
                <pointer> bay12: attack_chance_attackst
                    <pointer name='attack_item' type-name='item'/>
                    <int32_t name='attack_index'/>
                    <bitfield name='modifier_flags' type-name='attack_chance_modifier_flags'/>
                </pointer>
            </stl-vector>
            <stl-vector name='target'>
                <pointer> bay12: attack_chance_targetst
                    <int16_t name='target_bp'/>
                    <int32_t name='initial_hit_chance_adjustment'/>
                    <int32_t name='initial_hit_squareness_adjustment'/>
                    <bitfield name='modifier_flags' type-name='attack_chance_modifier_flags'/>
                </pointer>
            </stl-vector>

            <int32_t name='current_modifier_number'/>
            <int32_t name='current_attack_number'/>
            <int32_t name='current_target_number'/>
        </compound>
    </struct-type>

    <bitfield-type type-name='attack_chance_modifier_flags' base-type='uint32_t'> bay12: ATTACK_CHANCE_MODIFIER_FLAG_*
        <flag-bit name='HEAD'/>
        <flag-bit name='BODY'/>
        <flag-bit name='LIMB'/>
        <flag-bit name='PRIORITY_WIELD'/>
        <flag-bit name='MAIN_ATTACK'/>
        <flag-bit name='ADJUSTED_UP_LOTS'/>
        <flag-bit name='ADJUSTED_UP'/>
        <flag-bit name='ADJUSTED_DOWN'/>
        <flag-bit name='ADJUSTED_DOWN_LOTS'/>
        <flag-bit name='RING_OF_SAVINGS'/>
        <flag-bit name='GRASP'/>
        <flag-bit name='STANCE'/>
        <flag-bit name='ARMOR_3'/>
        <flag-bit name='ARMOR_2'/>
        <flag-bit name='ARMOR_1'/>
        <flag-bit name='SMALL_AIM_MINUS'/>
    </bitfield-type>

    <struct-type type-name='attack_chance_modifierst'>
        <pointer name='attack_item' type-name='item'/>
        <int32_t name='attack_index'/>
        <int16_t name='target_bp'/>
        <int32_t name='hit_chance_adjustment'/>
        <int32_t name='hit_squareness_adjustment'/>
        <bitfield name='flags' type-name='attack_chance_modifier_flags'/>
    </struct-type>

    <enum-type type-name='world_flags'> bay12: WorldFlagType
        <enum-item name='process_columns'/>
    </enum-type>
</data-definition>

<!--
Local Variables:
indent-tabs-mode: nil
nxml-child-indent: 4
End:
-->
